<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> redux · code and eat and drink and life</title><meta name="description" content="redux - YL"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lycworks.me/blog/atom.xml" title="code and eat and drink and life"></head><body><div class="wrap"><header><a href="/blog/" class="logo-link"><img src="/blog/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/blog/tags/" target="_self" class="nav-list-link">TAG</a></li><li class="nav-list-item"><a href="http://lycworks.me" target="_blank" class="nav-list-link">WEBSITE</a></li><li class="nav-list-item"><a href="https://github.com/ylu021" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/blog/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">redux</h1><div class="post-info">Feb 25, 2017</div><div class="post-content"><p>prerequisite - clear understanding of react</p>
<h1 id="What-is-redux"><a href="#What-is-redux" class="headerlink" title="What is redux?"></a>What is redux?</h1><p>Redux - a state manager that controls data flow and layout properties</p>
<h1 id="What-is-the-structure"><a href="#What-is-the-structure" class="headerlink" title="What is the structure?"></a>What is the structure?</h1><p>Actions, Reducers, Store?<br>But that’s not the structure, redux is simply a state object that represents your app, and they can be manipulated by the above components!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">default_state = &#123;</div><div class="line">  users: &#123;&#125;,</div><div class="line">  bgcolor: white</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Action-the-manipulator"><a href="#Action-the-manipulator" class="headerlink" title="Action - the manipulator"></a>Action - the manipulator</h3><p>usually in the format of js files (they all are actually), within the file, one can declare the methods that is going to manipulate the redux object <code>default_state</code>.</p>
<p>How it manipulate a state? Through actions dispatched by react components, like <strong>onclick</strong> event or form submission, that change the global <code>default_state</code>‘s properties.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">export function loadUsersAction()&#123;</div><div class="line">  return &#123;</div><div class="line">    type: &apos;LOAD_USERS&apos;,</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>inside an action-creator method, it returns the action for usage in reducer. How they are referred/identified is by <code>type</code>, which is an action tag</li>
<li>A good practice is to have a separate file that lists all the tags to enhance workflow and avoid typo</li>
</ul>
<h3 id="Reducer-the-updater"><a href="#Reducer-the-updater" class="headerlink" title="Reducer - the updater"></a>Reducer - the updater</h3><p>in its js file, one creates the <code>default_state</code> constant, and creates a state update function which is commonly called reducer, that takes two parameters default_state and action respectively.</p>
<blockquote>
<p>where it came from? <code>Array.prototype.reduce(reducer, default_state)</code>. For more info, visit <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="external">MDN javascript doc</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">export default function appReducer(state = defaultState, action)&#123;</div><div class="line">  switch(action.type)&#123;</div><div class="line">    case &apos;USER_LOADED&apos;:</div><div class="line">      return &#123;</div><div class="line">        ...state, //this is a object spread operator Object.assign() to create copies</div><div class="line">        users: action.users,</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">    case &apos;USER_CREATE&apos;:</div><div class="line">      return&#123;</div><div class="line">        ...state,</div><div class="line">        oneuser: action.oneuser,</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">      default:</div><div class="line">        return state;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>usually, a switcher is used for conditionally updating. How it switches is by the action tag (more complicated is that with middleware, we can create new tags)</li>
<li>in here we can see we can refer to action’s attribute as well. In the above example, I have a <code>createUserAction(user)</code> in <code>actions.js</code>, where i returned a variable called <code>oneuser</code></li>
<li>The <code>...</code> means object spread operator. This is equal to <code>Object.assign</code>, which is used for making a copy of an object. It is a good practice to always create new state instead of manipulating the <code>default_state</code></li>
</ul>
<h3 id="Store-the-state-packager"><a href="#Store-the-state-packager" class="headerlink" title="Store - the state packager"></a>Store - the state packager</h3><p>You might ask, why we need store when we can update state with reducer? Well, when we are processing get request, we want to return the state to the react components. The easiest way is the provided way, to have a store/manager imported to react’s entry point</p>
<p>To create a store, we first create <code>store.js</code> like we did for actions and reducers, within the js file we create a <code>createStore</code>, which takes two parameter reducer and middleWare. Here we introduced middleware, which is another reason we might want to use store. We will explain the purpose of middleware next.</p>
<h3 id="Middleware-the-async-data-flow-handler"><a href="#Middleware-the-async-data-flow-handler" class="headerlink" title="Middleware - the async data flow handler"></a>Middleware - the async data flow handler</h3><p>usually, when there are data, there are requests, when there are request, they are Asynchronous (what is async? refer to this <a href="http://stackoverflow.com/questions/16715380/what-is-difference-between-asynchronous-http-request-and-synchronous-http-reques" target="_blank" rel="external">doc</a>). Having async means there are going to be closure, and even through promise help a lot, it is still ugly code. When the request are dependent on each other, it can be a mess. That’s why we use middleware. Currently, there are two popular choices - <code>redux-saga</code> and <code>thunk</code>. In this lesson, since I only used redux-saga, for thunk info please look elsewhere.</p>
<h3 id="redux-saga"><a href="#redux-saga" class="headerlink" title="redux-saga"></a><code>redux-saga</code></h3><p><a href="https://redux-saga.github.io/redux-saga/docs/recipes/index.html" target="_blank" rel="external">doc</a></p>
<p>Saga is a middleware that uses generator functions to perform async transactions. The positive thing about having saga is they can log error, the negative thing is, for every action, there has to be a saga series of action handler and action listener.</p>
<p>example to illustrate<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//saga.js</div><div class="line">export function* loadUserSaga()&#123;</div><div class="line">  try&#123;</div><div class="line">    let users = yield getFetch(); //import from api.js</div><div class="line">    yield put(&#123;type:&apos;USER_LOADED&apos;, users: users&#125;)</div><div class="line">  &#125; catch(error) &#123;</div><div class="line">    console.log(error);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function* watchForLoadUsers()&#123;</div><div class="line">  yield takeEvery(&apos;LOAD_USERS&apos;, loadUserSaga);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//reducer.js</div><div class="line">  ...</div><div class="line">  switch(action.type)&#123;</div><div class="line">    case &apos;USER_LOADED&apos;:</div><div class="line">      return &#123;</div><div class="line">        ...state, //object spread operator == Object.assign() to create copies</div><div class="line">        users: action.users,</div><div class="line">      &#125;;</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<ul>
<li>the <code>*</code> means generator function</li>
<li>the handler is <code>loadUserSaga()</code>, which loads from an api’s fetch, and the response is saved to users and send back to reducer with a action tag <code>USER_LOADED</code>. Then in actions.js, the state can be updated by switch case <code>USER_LOADED</code>.</li>
<li><code>api.js</code> is where api calls are handled. It is a good practice to have them all in the same place.</li>
<li><code>put</code> (<code>call</code>, <code>take</code> and <code>takeEvery</code>) <a href="https://redux-saga.github.io/redux-saga/docs/basics/UsingSagaHelpers.html" target="_blank" rel="external"> info</a></li>
<li>often we create a wrapper <code>rootsaga</code> to start all the saga listeners</li>
</ul>
<h1 id="How-it-is-actually-used"><a href="#How-it-is-actually-used" class="headerlink" title="How it is actually used?"></a>How it is actually used?</h1><p>Inside our app’s react entry point, in my case is the index.js, we import the store and the saga (<a href="https://redux-saga.github.io/redux-saga/docs/introduction/BeginnerTutorial.html" target="_blank" rel="external"> implementation details</a>), and pass down to it’s children components as props through <code>Provider</code>, provided by <code>react-redux</code> module.</p>
<blockquote>
<p>note, saga only starts once, then watch for actions</p>
</blockquote>
<p><code>Provider</code> provides global access to redux store and child components, allow us to use <code>connect()</code> to communicate the data flow</p>
<p><code>connect()</code> has two parameters <code>mapStateToProps</code> and <code>mapDispatchToProps</code> and an immediate function call on <code>Componentname</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">immediate callback</div><div class="line">function()&#123;&#125;(Componentname)</div></pre></td></tr></table></figure>
<p><code>mapStateToProps</code> - <strong>read</strong> redux store state into react props</p>
<p><code>mapDispatchToProps</code> - <strong>receive</strong> response from dispatched actions and can create variables for injecting to view</p>
<ul>
<li><p>usually when we want to dispatch action from component, we first do <code>connect([params])(Componentname)</code>, then extract <code>dispatch</code> through <code>const { dispatch } = this.props</code>.</p>
</li>
<li><p><code>dispatch()</code> takes an imported action function</p>
</li>
</ul>
<p>For the current time, there are no full examples, but hopefully the basics of redux are explained well :)</p>
</div><div><label>Tags:</label><a href="/blog/tags/redux/">#redux</a></div></article></div></main><footer><div class="paginator"><a href="/blog/2017/02/17/router/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'https-ylu021-github-io-blog';
var disqus_identifier = '2017/02/25/reduxxxx/';
var disqus_title = 'redux';
var disqus_url = 'http://lycworks.me/blog/2017/02/25/reduxxxx/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//https-ylu021-github-io-blog.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="http://lycworks.me/blog">YL</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-71046273-3",'auto');ga('send','pageview');</script></body></html>